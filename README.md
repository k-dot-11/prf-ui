
# PRF - UI


PRF is a production ready form generator application powered by puppeteer, google apps script, and firebase. It takes in a transfermarkt match summary link and generates a google form for one of the teams' players. 

The frontend is based on react and the api is powered by express on nodejs. 

Once the user submits the transfermarkt url, the request goes from the react frontend to the api where first checks if this config of url and home or away team was already run before or not. If it was run before then the response is fetched from the cache otherwise the puppeteer is used to navigate to the url and scrape all the details that are necessary (team names, player names , subs names). 

Once we have the response from puppeteer it is sent to google apps script as a query param to a get call to the apps script's deployment. It then generates a form after doing some processing of the query params. Each player gets a linear scale based question in the form. Finally the form link is generated and it is sent back to our express app which in turn forwards it to the user on the front end. 

The app is secured on both the web and app layer. On the web no one can make a submission without logging in with their google account. Once logged in they can make submissions in which case the api's headers will contain the user's UID generated by firebase. So if anyone hits the request via postman they will not be able to generate forms.

On the app side the authentitcation is done via the firebase-auth powered middleware. It sees the request and checks if the headers contain a UID of a valid user. If valid it proceeds to check whether in the last 30 days the user has generated more than 5 forms. If yes it sends 429 status to the client. Finally the request goes to the main part of the code and apps script is called. 

## Google Apps Script: Automatic Form Creation

The script is called along with 4 params : 
- User Email
- isHomeTeam boolean
- Players array
- Subs array

The script then creates a google form which has 2 sections Starting 11 and the Substitutes and linear scale questions for each player in each category. Then the apps script gives edit access to the user who triggered the form creation. Finally before returning the form's edit and view link, it runs a function which checks all the forms in the admin google drive and deletes all the forms that are more than 3 weeks old.

Meaning the **forms you generated will be deleted after 3 weeks**.

